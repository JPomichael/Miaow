/*
 * Copyright (c) 2009 iPow(www.ipow.cn)
 */
var passport_site="http://sns.ipow.cn";function process_topic_form(D){if(!D)return false;var B=0;if(D.title){var C=$.trim(D.title.value),A=C.length;if(C=="\u81f3\u5c113\u4e2a\u5b57\u7b26\uff0c\u4e0d\u8d85\u8fc732\u4e2a\u5b57\u7b26"){B=1;alert("\u8bf7\u8f93\u5165\u5e16\u5b50\u6807\u9898")}else if(0==A){B=1;alert("\u5e16\u5b50\u6807\u9898\u4e3a\u7a7a")}else if(A<=3){B=1;alert("\u5e16\u5b50\u6807\u9898\u592a\u77ed")}if(B){D.title.focus();return false}}if(D.content){A=$.trim(D.content.value).length;if(A==0){B=1;alert("\u5e16\u5b50\u5185\u5bb9\u4e3a\u7a7a")}else if(A>10000){B=1;alert("\u5e16\u5b50\u5185\u5bb9\u8d85\u8fc71\u4e07\u6c49\u5b57\uff0c\u8bf7\u7f29\u51cf\u540e\u91cd\u65b0\u53d1\u5e16")}if(B){D.content.focus();return false}}if(D.verifyNum){A=$.trim(D.verifyNum.value).length;if(A!=4){alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u9a8c\u8bc1\u7801");D.verifyNum.focus();return false}}$("#btn").attr("disabled",true);return true}function quick_send(A){var D,B,C;if(!A.ctrlKey)return false;if(window.event)D=A.keyCode;else if(A.which)D=A.which;if(D==13)if($("#btn").attr("disabled")==false){$("#btn").attr("disabled",true);return $("#submit_form").submit()}return false}function postError(A){alert(A);$("#btn").attr("disabled",false)}function show_verify_image(A){if($("#imgverify").length)return;$("#verify_cell").prepend("<img id=\"imgverify\" alt=\"\u9a8c\u8bc1\u7801\"/>");$("<a id=\"retry_link\" href=\"#\" tabindex=\"999\">\u770b\u4e0d\u6e05\uff0c\u6362\u4e00\u5f20</a>").prependTo($("#retry_cell")).click(function(){$("#imgverify").attr("src","./getimage.php?do="+A+"&rdm="+Math.random());return false});$("#imgverify").load(function(){$("#verify_div").show();window.scrollTo(0,99999)}).attr("src","./getimage.php?do="+A+"&rdm="+Math.random())}function setReplyTitle(B){var A=$("#title");A.val(A.val().replace(/回复\s*\d*[:：](.*)/,"\u56de\u590d"+B+"\uff1a"+"$1"))}function opinion(A,D,E){var C=$("span",E).eq(0),B={op:"standpoint",pid:A,opinion:D,rdm:Math.random()};$.post("./post.php",B,function(G){var E=parseInt(G);if(E==0){var F=C.html(),B=F.search(/\d+/);if(B<0)F=F+" 1";else{var D=F.substring(0,B),A=parseInt(F.substr(B))+1;F=D+A}C.html(F)}else alert(G.substr(G.indexOf(" ")+1))})}function topicstat(A){$.ajax({type:"POST",url:"./post.php",data:"tid="+A+"&op=topicStat"})}function anonymity_update(){var A=$.trim($("#nickname").val()),B=A.length;if(B<"2"||B>"15"){alert("\u6635\u79f0\u957f\u5ea6\u4e0d\u5408\u6cd5\u3002");$("#nickname").focus();return false}$.ajax({type:"POST",url:"./anonymity.php?do=update",data:$("#anonymity-form").serialize(true),success:function(C){var B=parseInt(C);if(B==0){$("#loginStateInfo").html(A+"\uff0c\u60a8\u672a\u767b\u5f55\u3002");tb_remove()}else alert(C.substr(C.indexOf(" ")+1))}})}function anonymity_delete(){$.ajax({type:"POST",url:"./anonymity.php?do=delete",data:"rdm="+Math.random()});$("#loginStateInfo").html("\u60a8\u5c1a\u672a\u767b\u5f55\u3002");tb_remove()}function admin(){if($.trim($("#login-pwd").val())==""){alert("\u8bf7\u8f93\u5165\u5bc6\u7801");$("#login-pwd").focus();return false}$.ajax({type:"POST",url:"./admin.php?do=login",data:$("#login-form").serialize(true),success:function(B){var A=parseInt(B);if(A=="1")top.location.reload();else alert(B.substr(B.indexOf(" ")+1))}})}function logout(){var A=location.href;$.getScript(passport_site+"/api/checklogin.php?type=logout&href="+escape(A)+"&callback=OutSucess&rdm="+Math.random(),function(){})}function OutSucess(A){if(A.state)location.href="./login.php?do=logout&url="+escape(A.url)}function login(){if($.trim($("#email").val())==""){alert("\u8bf7\u60a8\u7684\u767b\u5f55Email:)");$("#email").focus();return false}if($.trim($("#pwd").val())==""){alert("\u8bf7\u60a8\u7684\u767b\u5f55\u5bc6\u7801:)");$("#pwd").focus();return false}var A=$("#login-form").serialize(true);$.getScript(passport_site+"/api/checklogin.php?type=login&"+A+"&callback=LSucess&rdm="+Math.random())}function LSucess(A){if(A.state)$.get("/checklogin.php?rdm="+Math.random(),{type:"login",uid:A.uid},function(A){if(A)top.location.reload()});else{alert("\u767b\u5f55\u90ae\u7bb1\u6216\u8005\u5bc6\u7801\u9519\u8bef\uff01\u8bf7\u91cd\u65b0\u8f93\u5165\uff1a\uff09");$("#email").focus();return false}}function profile(){if($.trim($("#oldpasswd").val()).length<"6"){alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u5f53\u524d\u5bc6\u7801");$("#oldpasswd").focus();return false}if($.trim($("#useremail").val()).length<"6"){alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7535\u5b50\u90ae\u7bb1\u5730\u5740");$("#useremail").focus();return false}$.ajax({type:"POST",url:"./profile.php?do=modify",data:$("#profile-form").serialize(true),success:function(B){var A=parseInt(B);if(A==0){alert(B.substr(B.indexOf(" ")+1));tb_remove()}else alert(B.substr(B.indexOf(" ")+1))}})}function apply(){var A=$.trim($("#applytype").val()),B=$.trim($("#applyreason").val()).length;if(B<"10"||B>"90"){if(A=="1")alert("\u7533\u8bf7\u7406\u7531\u5e94\u63a7\u5236\u572810\u523090\u4e2a\u5b57\u4e4b\u95f4");else alert("\u8f9e\u804c\u7406\u7531\u5e94\u63a7\u5236\u572810\u523090\u4e2a\u5b57\u4e4b\u95f4");$("#applyreason").focus();return false}$.ajax({type:"POST",url:"./apply.php?do=apply",data:$("#apply-form").serialize(true),success:function(C){if(C.length<"25"){var B=parseInt(C);if(B==0){alert(C.substr(C.indexOf(" ")+1));if(A=="1")tb_remove()}else alert(C.substr(C.indexOf(" ")+1))}else alert("\u72b6\u6001\u5f02\u5e38\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u3002")}})}function report(){var A=$.trim($("#reportcontent").val()).length;if(A<"3"||A>"80"){alert("\u4e3e\u62a5\u539f\u7531\u5e94\u63a7\u5236\u57283\u523080\u4e2a\u5b57\u4e4b\u95f4");$("#reportcontent").focus();return false}$.ajax({type:"POST",url:"./report.php?do=report",data:$("#report-form").serialize(true),success:function(B){var A=parseInt(B);if(A==0){alert(B.substr(B.indexOf(" ")+1));tb_remove()}else alert(B.substr(B.indexOf(" ")+1))}})}function create(){var A=$.trim($("#bar").val()).length;if(A<1||A>15){alert("\u5bb6\u65cf\u5708\u540d\u79f0\u957f\u5ea6\u4e0d\u5408\u6cd5");$("#bar").focus();return false}var B=$.trim($("#intro").val()).length;if(B<10||B>90){alert("\u5bb6\u65cf\u5708\u7b80\u4ecb\u5fc5\u987b\u4ecb\u4e8e10\u523090\u5b57\u4e4b\u95f4");$("#intro").focus();return false}$.ajax({type:"POST",url:"./create.php?do=create",data:$("#newForm").serialize(true),success:function(C){var B=parseInt(C),A=C.substr(C.indexOf(" ")+1);if(B=="2"){alert(A);top.location.href="./"}else if(B=="1")top.location.href=A;else alert(A)}})}function barRss(A){window.open("./rss.php?fid="+A)}function topicManage(A,F,C,B){var E=window.confirm("\u786e\u5b9a\u8981\u7ee7\u7eed\u6b64\u9879\u64cd\u4f5c\uff1f");if(E){var D={fid:A,id:F,ac:C,op:B,rdm:Math.random()};$.post("./manage.php",D,function(C){var B=C.substr(C.indexOf(" ")+1),A=parseInt(C);if(A==0){if(B=="OK")top.location.reload();else top.location.href=B}else alert(B)})}else return false}function setBlack(A,E,B){var D=window.confirm("\u786e\u5b9a\u8981\u5c01\uff1f");if(D){var C={fid:A,uid:E,str:B,op:"blockade",rdm:Math.random()};$.post("./manage.php",C,function(A){alert(A)})}else return false}function toggleSelect(){$(".operchk").each(function(A){if(this.disabled)return;if(this.checked)this.checked="";else this.checked="checked"})}function selectAll(){$(".operchk").each(function(A){if(this.disabled)return;this.checked="checked"})}function delSelItems(A,D){var B=$(".operchk").filter(function(){return!this.disabled&&this.checked}).map(function(){return this.value}).get().join(",");if(B.length==0)alert("\u8bf7\u9009\u62e9\u8981\u5220\u9664\u7684\u56de\u5e16");else{var E=window.confirm("\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e9b\u5e16\u5b50\u5417\uff1f");if(E){var C={fid:A,tid:D,pid:B,op:"batchDelete",rdm:Math.random()};$.post("./manage.php",C,function(C){var B=C.substr(C.indexOf(" ")+1),A=parseInt(C);if(A==0){if(B=="OK")top.location.reload();else top.location.href=B}else alert(B)})}}}function AddFavorite(){if(window.sidebar&&"object"==typeof(window.sidebar)&&"function"==typeof(window.sidebar.addPanel))window.sidebar.addPanel(document.title,document.location.href,"");else if(document.all&&"object"==typeof(window.external))window.external.addFavorite(document.location.href,document.title);else alert("\u672c\u529f\u80fd\u4ec5\u652f\u6301 IE \u548c FireFox \u6d4f\u89c8\u5668\uff01")}function caclWord(){var A=$.trim($("#applyreason").val()).length;$("#wcount").html(A)}function SearchSubmit(B){var A=$.trim(B.wd.value);if(A==""){alert("\u8bf7\u8f93\u5165\u5173\u952e\u8bcd");B.wd.value="";B.wd.focus();return false}if(B.tb[0].checked==false&&B.tb[1].checked==false&&B.tb[2].checked==false)return false}function clueOn(A){if(A==1)$("#clueon").html("\u8f93\u5165\u5bb6\u65cf\u5708\u540d\u79f0\u76f4\u63a5\u56de\u8f66\u5373\u53ef\u8fdb\u5165\u8be5\u5bb6\u65cf\u5708\uff0c\u5982\u679c\u5bb6\u65cf\u5708\u4e0d\u5b58\u5728\u5373\u53ef\u521b\u5efa\u3002");if(A==2)$("#clueon").html("\u8f93\u5165\u5173\u952e\u8bcd\u76f4\u63a5\u56de\u8f66\u5373\u53ef\u641c\u7d22");if(A==3)$("#clueon").html("\u8f93\u5165\u4f5c\u8005\u540d\u79f0\u76f4\u63a5\u56de\u8f66\u5373\u53ef\u641c\u7d22")}function checklogin(){$.getScript(passport_site+"/api/checklogin.php?type=chk&callback=Logined&rdm="+Math.random())}function Logined(A){if(A.state)$.get("/checklogin.php?rdm="+Math.random(),{type:"login",uid:A.uid},function(B){if(B){var C="<ul><li><a  href=\"javascript:;\" onclick=\"logout()\">\u9000\u51fa</a></li>\t\t\t\t<li class=\"split\">|</li>\t\t\t\t<li>\u60a8\u597d\uff01<a title=\""+A.username+"\" href=\""+passport_site+"/index.php?s=/space/"+A.uid+"\">"+A.username+"</a></li>\t\t\t\t</ul>";$("#header_links").html(C);var D="<ul class=\"login1\"><li><a href=\""+passport_site+"/apps/blog/index.php?s=/Index/addBlog\" title=\"\u53d1\u8868\u65e5\u5fd7\">\u53d1\u8868\u65e5\u5fd7</a></li>\t\t\t\t<li><a href=\""+passport_site+"/apps/blog/index.php?s=/Index/addBlog\" title=\"\u4e0a\u4f20\u7167\u7247\">\u4e0a\u4f20\u7167\u7247</a></li>\t\t\t\t<li><a href=\""+passport_site+"/apps/event/index.php?s=/Index/addEvent\" title=\"\u53d1\u8d77\u6d3b\u52a8\">\u53d1\u8d77\u6d3b\u52a8</a></li>\t\t\t\t<li><a href=\""+passport_site+"/index.php?s=/Privacy\" title=\"\u9690\u79c1\u8bbe\u7f6e\">\u9690\u79c1\u8bbe\u7f6e</a></li>\t\t\t\t<li><a href=\""+passport_site+"/index.php?s=/Info\" title=\"\u4fee\u6539\u8d44\u6599\">\u4fee\u6539\u8d44\u6599</a></li>\t\t\t\t<li><a href=\""+passport_site+"/index.php?s=/space/"+A.uid+"\" title=\"\u4e2a\u4eba\u7a7a\u95f4\">\u4e2a\u4eba\u7a7a\u95f4</a></li></ul>";$("#ppLoginForm").html(D)}});else $.get("/checklogin.php?rdm="+Math.random(),{type:"loginout"},function(){var A="<ul>\t\t\t<li><a title=\"\u53d6\u56de\u5bc6\u7801\" href=\""+passport_site+"/default.php?getpass&amp;ap=getpass\">\u53d6\u56de\u5bc6\u7801</a></li>\t\t\t<li class=\"split\">|</li>\t\t\t<li><a title=\"\u6ce8\u518c\" href=\""+passport_site+"/default.php?reg&amp;ap=qz\">\u6ce8\u518c</a></li>\t\t\t<li class=\"split\">|</li>\t\t\t<li><a href=\"./login.php?height=139&width=296\" class=\"thickbox\" title=\"\u7528\u6237\u767b\u5f55\">\u767b\u5f55</a></li>\t\t\t</ul>";$("#header_links").html(A);var B="<ul class=\"ullogin\">                        <li><label>Email\uff1a</label><input class=\"txtInputC\" id=\"txtEmail\" type=\"text\" value=\"\" /></li>                        <li><label>\u5bc6\u3000\u7801\uff1a</label><input class=\"txtInputC\" id=\"txtPassword\" type=\"password\" value=\"\" /></li>                    </ul>                    <a id=\"btnLogin\" href=\"javascript:;\" onclick=\"UserLogin()\" class=\"btnLogin\"></a>                    <p>                    \t<label></label>                    \t<label style=\"text-align:left; width:20px;\"><input type=\"checkbox\" /></label>                        <em>\u8bb0\u4f4f\u5bc6\u7801</em>                        <a href=\""+passport_site+"/?reg&ap=qz\" title=\"\u7acb\u5373\u52a0\u5165\">\u7acb\u5373\u52a0\u5165</a>                        <a href=\""+passport_site+"/?getpass&ap=getpass\" title=\"\u5fd8\u8bb0\u5bc6\u7801\">\u627e\u56de\u5bc6\u7801</a>                    </p>";$("#ppLoginForm").html(B);tb_init("a.thickbox")})}function UserLogin(){var B=$("#txtEmail").val(),A=$("#txtPassword").val();if($.trim(B)==""){alert("\u8bf7\u8f93\u5165\u767b\u9646\u90ae\u7bb1\uff1a\uff09");$("#txtEmail").focus();return false}if($.trim(A)==""){alert("\u8bf7\u8f93\u5165\u767b\u9646\u5bc6\u7801\uff1a\uff09");$("#txtPassword").focus();return false}$.getScript(passport_site+"/api/checklogin.php?type=login&email="+B+"&pwd="+A+"&callback=LoginSucess&rdm="+Math.random())}function LoginSucess(B){if(B.state){var C="<ul class=\"login1\"><li><a href=\""+passport_site+"/apps/blog/index.php?s=/Index/addBlog\" title=\"\u53d1\u8868\u65e5\u5fd7\">\u53d1\u8868\u65e5\u5fd7</a></li>\t\t<li><a href=\""+passport_site+"/apps/blog/index.php?s=/Index/addBlog\" title=\"\u4e0a\u4f20\u7167\u7247\">\u4e0a\u4f20\u7167\u7247</a></li>\t\t<li><a href=\""+passport_site+"/apps/event/index.php?s=/Index/addEvent\" title=\"\u53d1\u8d77\u6d3b\u52a8\">\u53d1\u8d77\u6d3b\u52a8</a></li>\t\t<li><a href=\""+passport_site+"/index.php?s=/Privacy\" title=\"\u9690\u79c1\u8bbe\u7f6e\">\u9690\u79c1\u8bbe\u7f6e</a></li>\t\t<li><a href=\""+passport_site+"/index.php?s=/Info\" title=\"\u4fee\u6539\u8d44\u6599\">\u4fee\u6539\u8d44\u6599</a></li>\t\t<li><a href=\""+passport_site+"/index.php?s=/space/"+B.uid+"\" title=\"\u4e2a\u4eba\u7a7a\u95f4\">\u4e2a\u4eba\u7a7a\u95f4</a></li></ul>";$("#ppLoginForm").html(C);var A="<ul><li><a href=\"javascript:;\" onclick=\"logout()\">\u9000\u51fa</a></li>\t\t<li class=\"split\">|</li>\t\t<li>\u60a8\u597d\uff01<a title=\""+B.username+"\" href=\""+passport_site+"/index.php?s=/space/"+B.obj+"\">"+B.username+"</a></li>\t\t</ul>";$("#header_links").html(A)}else alert("\u767b\u9646\u5931\u8d25\uff01")}function checkcount(C,A,B){document.getElementById(A).onfocus=document.getElementById(A).onkeydown=document.getElementById(A).onkeyup=function(){var E=parseInt($("#"+A).val().length);if(E>C){var D=$.trim($("#"+A).val());$("#"+A).val(D.substring(0,C))}else document.getElementById(B).innerHTML=C-E}}
$(document).ready(function()
{
	checklogin();
});